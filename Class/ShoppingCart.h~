#pragma once

#include "CartItem.h"


class ShoppingCart {
private:
    static ShoppingCart instance;
    CartItem cartItems[10];
    int itemCount = 0;
    ShoppingCart(): itemCount(0){}

public:
    static ShoppingCart& getInstance() {
        return instance;
    }

    void addToCart(const CartItem& item) {
        for (int i = 0; i < itemCount; i++) {
            if (cartItems[i].getProduct().getId() == item.getProduct().getId()) {
                cartItems[i].setQuantity(cartItems[i].getQuantity() + item.getQuantity());
                return;
            }
        }

        if (itemCount < 10) {
            cartItems[itemCount] = item;
            itemCount++;
        }
    }

    void removeFromCart(const CartItem& item) {
        for (int i = 0; i < itemCount; i++) {
            if (cartItems[i].getProduct().getId() == item.getProduct().getId()) {
                if (cartItems[i].getQuantity() > item.getQuantity()) {
                    cartItems[i].setQuantity(cartItems[i].getQuantity() - item.getQuantity());
                } else {
                    itemCount--;
                    for (int j = i; j < itemCount; j++) {
                        cartItems[j] = cartItems[j + 1];
                    }
                }
                return;
            }
        }
    }

    double calculateTotal() {
        double total = 0;
        for (int i = 0; i < itemCount; i++) {
            total += cartItems[i].getProduct().getPrice() * cartItems[i].getQuantity();
        }
        return total;
    }

    void printCart() {
        cout << left << setw(12) << "Product ID"
             << setw(20) << "Name"
             << setw(10) << "Price"
             << setw(10) << "Quantity"
             << endl;

        cout << string(52, '-') << endl; // Print a separator line

        for (const auto &item: cartItems) {
            cout << left << setw(12) << item.getProduct().getId()
                 << setw(20) << item.getProduct().getName()
                 << setw(10) << fixed << setprecision(2) << item.getProduct().getPrice()
                 << setw(10) << item.getQuantity()
                 << endl;
        }
        cout << string(52, '-') << endl;
        cout << "Total: " << calculateTotal() << endl;
    }
};